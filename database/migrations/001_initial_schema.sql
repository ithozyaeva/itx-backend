CREATE TABLE "members" (
	"id" INTEGER NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
	"tg" VARCHAR(255),
	"name" VARCHAR(255),
	PRIMARY KEY("id")
);


CREATE TABLE "mentors" (
	"id" INTEGER NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
	"memberId" INTEGER NOT NULL,
	"occupation" VARCHAR(255),
	"experience" VARCHAR(255),
	"order" INTEGER NOT NULL,
	PRIMARY KEY("id", "memberId")
);

CREATE INDEX "mentors_index_0"
ON "mentors" ("memberId");

CREATE TABLE "profTags" (
	"id" INTEGER NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
	"title" VARCHAR(255) NOT NULL,
	PRIMARY KEY("id")
);


CREATE TABLE "mentorsTags" (
	"id" INTEGER NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
	"mentorId" INTEGER NOT NULL,
	"tagId" INTEGER NOT NULL,
	PRIMARY KEY("id")
);


CREATE TABLE "reviewOnService" (
	"id" INTEGER NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
	"author" VARCHAR(255) NOT NULL,
	"text" VARCHAR(255) NOT NULL,
	"serviceId" INTEGER NOT NULL,
	"date" DATE NOT NULL,
	PRIMARY KEY("id")
);


CREATE TABLE "services" (
	"id" INTEGER NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
	"name" VARCHAR(255) NOT NULL,
	"price" INTEGER,
	"ownerId" INTEGER NOT NULL,
	PRIMARY KEY("id")
);


CREATE TABLE "reviewOnCommunity" (
	"id" INTEGER NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
	"authorId" INTEGER NOT NULL,
	"text" VARCHAR(255) NOT NULL,
	"date" DATE NOT NULL,
	PRIMARY KEY("id")
);


CREATE TABLE "users" (
	"id" INTEGER NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
	"login" VARCHAR(255) NOT NULL,
	"password" VARCHAR(255) NOT NULL,
	"email" VARCHAR(255) NOT NULL,
	"role" SMALLINT NOT NULL,
	PRIMARY KEY("id")
);


CREATE TABLE "contacts" (
	"id" INTEGER NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
	"type" SMALLINT NOT NULL,
	"link" VARCHAR(255) NOT NULL,
	"ownerId" INTEGER NOT NULL,
	PRIMARY KEY("id")
);


ALTER TABLE "mentors"
ADD FOREIGN KEY("memberId") REFERENCES "members"("id")
ON UPDATE NO ACTION ON DELETE CASCADE;
ALTER TABLE "mentorsTags"
ADD FOREIGN KEY("mentorId") REFERENCES "mentors"("id")
ON UPDATE NO ACTION ON DELETE CASCADE;
ALTER TABLE "mentorsTags"
ADD FOREIGN KEY("tagId") REFERENCES "profTags"("id")
ON UPDATE NO ACTION ON DELETE CASCADE;
ALTER TABLE "services"
ADD FOREIGN KEY("ownerId") REFERENCES "mentors"("id")
ON UPDATE NO ACTION ON DELETE CASCADE;
ALTER TABLE "reviewOnService"
ADD FOREIGN KEY("serviceId") REFERENCES "services"("id")
ON UPDATE NO ACTION ON DELETE CASCADE;
ALTER TABLE "contacts"
ADD FOREIGN KEY("ownerId") REFERENCES "mentors"("id")
ON UPDATE NO ACTION ON DELETE CASCADE;
ALTER TABLE "reviewOnCommunity"
ADD FOREIGN KEY("authorId") REFERENCES "members"("id")
ON UPDATE NO ACTION ON DELETE CASCADE;


-- Добавляем супер-пользователя
-- login: admin, password: 3_lgWfY0yI
insert into users (login, password, email, role) values ('admin', '03414ef2e347d2d4691c41de6f8dd7dda414fbb26840eaac27fadd27affe4dcd97bdc79616d2f6e66af7fd988fea6341ab6e103c33b7562adfb1d1a779a6fde7', 'admin@admin', 0);